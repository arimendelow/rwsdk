---
title: Authentication Guide
description: Learn about the authentication mechanisms in the standard starter, including passkeys, session management, and bot protection.
---

# Authentication

We've baked authentication right into the **standard starter**, giving you everything you need to handle users, sessions, and logins out of the box. The standard starter uses **passkeys ([WebAuthn](https://webauthn.guide/))** for passwordless authentication, **session persistence via [Cloudflare Durable Objects](https://developers.cloudflare.com/durable-objects/)**, and **bot protection with [Cloudflare Turnstile](https://developers.cloudflare.com/turnstile/)**. The database layer is powered by **[Cloudflare D1](https://developers.cloudflare.com/d1/)** and **[Prisma](https://www.prisma.io/)**.

ðŸ”— **[Standard Starter Repo](https://github.com/redwoodjs/sdk/tree/main/starters/standard)**

## Retrieving a Session

Sessions are handled using **cookies** (for session IDs) and **Durable Objects** (for storing session data). This means each session has a dedicated Durable Object instance, keeping session data accessible without needing a database query on every request.

When a request comes in, we:

1. Check for a **`session_id` cookie**.
2. Verify that the session ID is valid by checking its signature - this lets us know that was us that issued the session ID
3. If it's valid, load the session from the **Durable Object**.
4. If there's an active session, we pull the user ID from it and load the user from the **database ([D1](https://developers.cloudflare.com/d1/) + [Prisma](https://www.prisma.io/))**.

### Why Durable Objects?

Instead of keeping session data in multiple places where weâ€™d have to worry about syncing and stale data, each session is stored in a single **Durable Object** instance. This means we donâ€™t have to deal with session data being out of date or lingering after logoutâ€”itâ€™s all in one place, making revocation straightforward. A nice side effect of this approach is that when a session is active, it stays in memory, so lookups are fast without extra database queries.

For more on Durable Objects, see [Cloudflare's documentation](https://developers.cloudflare.com/durable-objects/).

---

## Logging In

We use **passkeys ([WebAuthn](https://webauthn.guide/))** for authentication. This allows users to log in without passwords, using their authenticator, browser or device to handle authentication securely.

For more on passkeys, see [passkeys.dev](https://passkeys.dev/).

### Login Flow

1. The user clicks **Login**.
2. The frontend calls a server action to get a WebAuthn challenge.
3. The challenge is stored in the **session store** using `session.save()`.
4. The user's authenticator signs the challenge.
5. The signed challenge is sent back to the server and verified.
6. If successful, the session is updated with the **user ID**.

### Session Handling in Login

- The **WebAuthn challenge** is temporarily stored in the session.
- After login, the session updates with the user ID.
- `session.save()` persists these changes and updates the **Set-Cookie** header.

---

## Registering Users

Registration follows the same two-step WebAuthn process as login, but with an extra layer of **bot protection** using [Cloudflare Turnstile](https://developers.cloudflare.com/turnstile/).

### Why Turnstile?

Cloudflare already has bot protection, but there's a short gap before it fully picks up on attack patterns. Turnstile adds a lightweight challenge **before** registration happens, blocking automated signups.

### Turnstile in the Registration Flow

1. The Turnstile **client script** is loaded on the page.
2. The frontend calls `useTurnstile()` to generate a challenge token.
3. The token is sent to the backend along with the WebAuthn data.
4. The backend verifies the token using `verifyTurnstileToken()` before completing registration.
